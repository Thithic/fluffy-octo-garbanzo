import datetime
from datetime import datetime, timedelta
import matplotlib.pyplot as plt

nb_tags = 4

ignored = []

tag_names = ["chambre", "couloir", "radiateur", "salon"]
label = ["Chambre", "Dehors", "Radiateur", "Salon"]
top = ["radiateur"]
#bottom = []

temperature = []
humidity = []
times_temp = []
times_humidity = []

for i in range(nb_tags):
    temperature.append([])
    humidity.append([])
    times_temp.append([])
    times_humidity.append([])

for i in range(len(tag_names)):
    if i in ignored:
        continue
    with open(f"{tag_names[i]}.txt", "r") as f:
        line="1"
        while line:
            line=f.readline()
            sp = line.replace("\n", "").split(",")
            if len(sp) >= 2:
                times_temp[i].append(datetime.fromtimestamp(int(sp[0])))
                temperature[i].append(float(sp[1]))
            if len(sp) >= 3:
                times_humidity[i].append(datetime.fromtimestamp(int(sp[0])))
                humidity[i].append(int(sp[2]))


plt.figure(0, figsize=(20,20))

subplot_number = 3

for i in range(nb_tags):
    if i in ignored:
        continue
    if tag_names[i] in top:
        plt.subplot(subplot_number, 1, 1)
    else:
        plt.subplot(subplot_number, 1, 2)
        
    line = plt.plot(times_temp[i], temperature[i], "o", markersize=5.0)
    line[0].set_label(label[i])
    
    plt.subplot(subplot_number, 1, 3)
    line2 = plt.plot(times_humidity[i], humidity[i], "-", markersize=5.0)
    line2[0].set_label(label[i])


for i in range(1,subplot_number+1):
    plt.subplot(subplot_number, 1, i)
    plt.legend()

for i in range(1,subplot_number+1):
    plt.subplot(subplot_number, 1, i)
    plt.xlim([datetime.now() + timedelta(days=-1), datetime.now() + timedelta(minutes=30)])
# plt.show()
plt.savefig("docs/24hours.png")

for i in range(1,subplot_number+1):
    plt.subplot(subplot_number, 1, i)
    plt.xlim([datetime.now() + timedelta(hours=-12), datetime.now() + timedelta(minutes=30)])
plt.savefig("docs/12hours.png")

for i in range(1,subplot_number+1):
    plt.subplot(subplot_number, 1, i)
    plt.xlim([datetime.now() + timedelta(days=-5), datetime.now() + timedelta(hours=1)])
plt.savefig("docs/5days.png")
