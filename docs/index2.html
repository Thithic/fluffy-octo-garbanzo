<!doctype html>

<html>

	<head>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script> -->
		<!-- <script src="mqtt_sub.js" type="text/javascript"></script> -->
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		<!-- <link rel="stylesheet" href="style.css"> -->
		<title>github site test</title>
	</head>

	<body>
	
		<!-- 
		
		<h1>Données temps-réel</h1>
	
		<div class="line" id="line1">
			<div class="tag">
				<div class="title">
					Chambre
				</div>
				<div class="data">
					<div id="chambre_temp" class="temperature">18.43°C</div>
					<div id="chambre_humi" class="humidite">57%</div>
				</div>
			</div>
			
			<div class="tag">
				<div class="title">
					Salon
				</div>
				<div class="data">
					<div id="salon_temp" class="temperature">18.43°C</div>
					<div id="salon_humi" class="humidite">57%</div>
				</div>
			</div>
		</div>
		
		<div class="line" id="line2">
			<div class="tag">
				<div class="title">
					Dehors
				</div>
				<div class="data">
					<div id="couloir_temp" class="temperature">18.43°C</div>
					<div id="couloir_humi" class="humidite">57%</div>
				</div>
			</div>
			
			<div class="tag">
				<div class="title">
					Radiateur
				</div>
				<div class="data">
					<div id="radiateur_temp" class="temperature">18.43°C</div>
					<div id="radiateur_humi" class="humidite">57%</div>
				</div>
			</div>
		</div>
	
	
		<h1>Historique 12 heures</h1>
		<img src="12hours.png" alt="12hours">
		
		<h1>Historique 24 heures</h1>
		<img src="24hours.png" alt="24hours">
		
		<h1>Historique 5 jours</h1>
		<img src="5days.png" alt="5days">
		
		-->
		
		<div id="radi_temp" style="width:99%"></div>
		<div id="house_temp" style="width:99%"></div>
		
		
		<script src="data.js"></script>
		
		<script>
		
		var top_graph = [2]
		
		var times = []
		var temps = []
		var humis = []
		
		var to_ignore = 1; // keep 1 point every 10
		
		for (let i = 0 ; i < nb_tags ; i++) {
			times.push([])
			temps.push([])
			humis.push([])
		}
		
		tags.forEach((value, index, array) => {
			value.forEach((line, id, arr) => {
				let s = line.split(",")
				let a = new Date(s[0]*1000)
				let b = s[1]
				let c = s[2]
				
				if(id%to_ignore == 0){
					times[index].push(a)
					temps[index].push(b)
					humis[index].push(c)
				}
				
			});
		});
		
		var data_temp_top = []
		var data_temp_bot = []
		
		for (let i = 0 ; i < nb_tags ; i++) {
			<!-- let content = { -->
				<!-- x:times[i], -->
				<!-- y:temps[i], -->
				<!-- mode:"markers", -->
				<!-- marker: { -->
					<!-- size: 2 -->
				<!-- }, -->
			<!-- } -->
			if (top_graph.includes(i)) {
				data_temp_top.push({	
					x:times[i],
					y:temps[i],
					mode:"markers",
					marker: {
						size: 2
					},
					yaxis: 'y2'
				})
			} else {
				data_temp_top.push({
					x:times[i],
					y:temps[i],
					mode:"markers",
					marker: {
						size: 2
					},
				})
			}
		}
		
		var selectorOptions = {
			buttons: [{
				step: 'hour',
				stepmode: 'backward',
				count: 12,
				label: '12h'
			}, {
				step: 'hour',
				stepmode: 'backward',
				count: 24,
				label: '24h'
			}, {
				step: 'day',
				stepmode: 'backward',
				count: 5,
				label: '5j'
			}, {
				step: 'all',
			}],
		};

		// Define Layout
		var layout = {
			xaxis: {
				rangeselector: selectorOptions
			},
			yaxis: {title: 'yaxis title'},
			yaxis2: {
				title: 'yaxis2 title',
				titlefont: {color: 'rgb(148, 103, 189)'},
				tickfont: {color: 'rgb(148, 103, 189)'},
				overlaying: 'y',
				side: 'right'
			}
		};

		// Display using Plotly
		Plotly.newPlot("radi_temp", data_temp_top, layout);
		<!-- Plotly.newPlot("house_temp", data_temp_bot, layout); -->
		
		<!-- plot_radi = document.getElementById("radi_temp") -->
		
		<!-- plot_radi.on("plotly_relayout", function(eventData){ -->
			<!-- console.log("plotly_relayout") -->
			<!-- console.log(eventData) -->
		<!-- }); -->
		
		</script>
		
	</body>


</html>
